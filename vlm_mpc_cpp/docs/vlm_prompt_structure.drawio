<mxfile host="app.diagrams.net">
  <diagram id="VLM-Prompt-Structure" name="VLM Prompt Structure">
    <mxGraphModel dx="1434" dy="790" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="VLM Prompt Structure for Social Navigation" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="180" y="20" width="490" height="30" as="geometry" />
        </mxCell>

        <!-- Input Image Box -->
        <mxCell id="image-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="770" height="180" as="geometry" />
        </mxCell>

        <mxCell id="image-title" value="Input Image:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="60" y="80" width="120" height="20" as="geometry" />
        </mxCell>

        <mxCell id="image-placeholder" value="[RGB Image from Robot Camera]&#xa;&#xa;Shows: Forward-facing view with detected persons&#xa;Resolution: Camera-dependent&#xa;Format: Base64-encoded JPEG" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;align=center;verticalAlign=middle;" vertex="1" parent="1">
          <mxGeometry x="200" y="110" width="450" height="120" as="geometry" />
        </mxCell>

        <!-- Input Prompt Box -->
        <mxCell id="prompt-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="40" y="280" width="770" height="1050" as="geometry" />
        </mxCell>

        <mxCell id="prompt-title" value="Input Prompt:" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="60" y="290" width="120" height="20" as="geometry" />
        </mxCell>

        <!-- Section 1: System Role -->
        <mxCell id="section1" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="320" width="730" height="80" as="geometry" />
        </mxCell>

        <mxCell id="section1-content" value="&lt;b&gt;1. System Role&lt;/b&gt;&lt;br&gt;You are a social navigation advisor for a mobile robot.&lt;br&gt;The robot has a forward-facing RGB-D camera. You are given:&lt;br&gt;1) The current RGB image from the camera&lt;br&gt;2) A summary of humans detected in 3D using depth&lt;br&gt;3) The robot's navigation goal and motion state&lt;br&gt;..." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="70" y="325" width="710" height="70" as="geometry" />
        </mxCell>

        <!-- Section 2: Robot State -->
        <mxCell id="section2" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="410" width="730" height="80" as="geometry" />
        </mxCell>

        <mxCell id="section2-content" value="&lt;b&gt;2. Robot State&lt;/b&gt;&lt;br&gt;- Current linear velocity: 0.28 m/s&lt;br&gt;- Current angular velocity: 0.05 rad/s&lt;br&gt;- Goal direction: straight ahead (bearing: 2.3°)&lt;br&gt;- Goal distance: 15.42 m" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="70" y="415" width="710" height="70" as="geometry" />
        </mxCell>

        <!-- Section 3: Detected Humans -->
        <mxCell id="section3" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="500" width="730" height="130" as="geometry" />
        </mxCell>

        <mxCell id="section3-content" value="&lt;b&gt;3. Detected Humans (from 3D bounding boxes)&lt;/b&gt;&lt;br&gt;&lt;b&gt;Human 1:&lt;/b&gt;&lt;br&gt;  - Distance: 4.52 m (front-right)&lt;br&gt;  - Speed: 0.85 m/s (walking)&lt;br&gt;  - Direction: moving away from robot&lt;br&gt;  - Tracking confidence: 0.92&lt;br&gt;&lt;b&gt;Human 2:&lt;/b&gt;&lt;br&gt;  - Distance: 6.13 m (right side)&lt;br&gt;  - Speed: 0.0 m/s (standing)&lt;br&gt;  - Direction: stationary&lt;br&gt;  - Tracking confidence: 0.88&lt;br&gt;..." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="70" y="505" width="710" height="120" as="geometry" />
        </mxCell>

        <!-- Section 4: Human Clusters -->
        <mxCell id="section4" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="640" width="730" height="90" as="geometry" />
        </mxCell>

        <mxCell id="section4-content" value="&lt;b&gt;4. Human Clusters&lt;/b&gt;&lt;br&gt;&lt;b&gt;Cluster 0:&lt;/b&gt;&lt;br&gt;  - Size: 2 people&lt;br&gt;  - Centroid: 5.2m from robot (right side)&lt;br&gt;  - Members: Person 1, Person 2&lt;br&gt;  - Density: sparse (1-2 people)&lt;br&gt;..." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="70" y="645" width="710" height="80" as="geometry" />
        </mxCell>

        <!-- Section 5: Parameter Guidelines (NEW - with side_preference fix) -->
        <mxCell id="section5" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#b1ddf0;strokeColor=#10739e;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="740" width="730" height="250" as="geometry" />
        </mxCell>

        <mxCell id="section5-content" value="&lt;b&gt;5. Parameter Guidelines&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;min_personal_distance&lt;/b&gt; (0.5-2.0m): ...&lt;br&gt;&lt;b&gt;speed_scale&lt;/b&gt; (0.0-1.0): ...&lt;br&gt;&lt;br&gt;&lt;b&gt;side_preference (left, right, neutral) - CRITICAL PARAMETER:&lt;/b&gt;&lt;br&gt;⚠️ IMPORTANT: Both 'left' and 'right' are EQUALLY VALID.&lt;br&gt;&lt;br&gt;&lt;b&gt;Decision rules (MUST FOLLOW EXACTLY):&lt;/b&gt;&lt;br&gt;  1. People on LEFT side  → side_preference = 'right' (pass RIGHT)&lt;br&gt;  2. People on RIGHT side → side_preference = 'left' (pass LEFT)&lt;br&gt;  3. People on BOTH sides → side_preference = 'neutral'&lt;br&gt;&lt;br&gt;&lt;b&gt;Examples:&lt;/b&gt;&lt;br&gt;  • People at front-LEFT → side_preference='right'&lt;br&gt;  • People at front-RIGHT → side_preference='left'&lt;br&gt;  • 3 people LEFT, 1 far RIGHT → side_preference='right'&lt;br&gt;&lt;br&gt;⚠️ BIAS CHECK: Choose the side with MORE clearance." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="70" y="745" width="710" height="240" as="geometry" />
        </mxCell>

        <!-- Section 6: Velocity Rules -->
        <mxCell id="section6" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fad7ac;strokeColor=#b46504;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="1000" width="730" height="120" as="geometry" />
        </mxCell>

        <mxCell id="section6-content" value="&lt;b&gt;6. Velocity-Based Decision Rules&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;Person APPROACHING:&lt;/b&gt; INCREASE distance, DECREASE speed, choose side away&lt;br&gt;&lt;b&gt;Person MOVING AWAY:&lt;/b&gt; Standard distance, maintain higher speed&lt;br&gt;&lt;b&gt;Person CROSSING:&lt;/b&gt; Moderate distance, REDUCE speed&lt;br&gt;&lt;b&gt;Person STATIONARY:&lt;/b&gt; Standard distance, higher speed possible&lt;br&gt;&lt;b&gt;Person FAST (&gt;1.5m/s):&lt;/b&gt; INCREASE distance, STRONGLY reduce speed&lt;br&gt;..." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="70" y="1005" width="710" height="110" as="geometry" />
        </mxCell>

        <!-- Section 7: Example Scenarios -->
        <mxCell id="section7" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="1130" width="730" height="80" as="geometry" />
        </mxCell>

        <mxCell id="section7-content" value="&lt;b&gt;7. Example Scenarios&lt;/b&gt;&lt;br&gt;&lt;br&gt;1. Person at 2m front-right, STATIONARY → distance: 1.0m, speed: 0.8, side: 'left'&lt;br&gt;2. Person at 3m front-left, APPROACHING → distance: 1.5m, speed: 0.6, side: 'right'&lt;br&gt;3. Dense crowd (6 people) → distance: 0.7m, speed: 0.5, side: based on clearance&lt;br&gt;..." style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;spacingLeft=10;" vertex="1" parent="1">
          <mxGeometry x="70" y="1135" width="710" height="70" as="geometry" />
        </mxCell>

        <!-- Section 8: JSON Output Format -->
        <mxCell id="section8" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#bac8d3;strokeColor=#23445d;align=left;verticalAlign=top;spacingLeft=10;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="60" y="1220" width="730" height="100" as="geometry" />
        </mxCell>

        <mxCell id="section8-content" value="&lt;b&gt;8. Required JSON Output Format&lt;/b&gt;&lt;br&gt;{&lt;br&gt;  &quot;scene_type&quot;: &quot;corridor&quot;,&lt;br&gt;  &quot;crowd_density&quot;: &quot;sparse&quot;,&lt;br&gt;  &quot;side_preference&quot;: &quot;left&quot;,&lt;br&gt;  &quot;speed_scale&quot;: 0.85,&lt;br&gt;  &quot;min_personal_distance&quot;: 1.3,&lt;br&gt;  &quot;explanation&quot;: &quot;Two people on right side, pass left...&quot;&lt;br&gt;}" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;spacingLeft=10;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="70" y="1225" width="710" height="90" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="40" y="1350" width="770" height="30" as="geometry" />
        </mxCell>

        <mxCell id="legend" value="Key Fix: Section 5 now includes emphatic instructions and examples to prevent LEFT bias" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=2;fontColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="60" y="1355" width="730" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
